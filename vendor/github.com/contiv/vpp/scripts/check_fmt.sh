#!/usr/bin/env bash


WHITELIST_CONTENT="^// DO NOT EDIT|^// File generated by|^// Code generated by|^// Automatically generated"

FILES=$(find "." -mount -name "*.go" -type f -not -path "./vendor/*" -exec grep -LE "${WHITELIST_CONTENT}"  {} + )

MATCH=$(echo "${FILES}" | sed "s/\.\///g")

ALL=$(diff -u <(echo -n) <(gofmt -d -s .))

OUT=$(echo "${ALL}" | grep -F "${MATCH}"  | grep -v "vendor")

if [[ ! -z ${OUT} ]] ; then
    echo "Go fmt the following files:"
    echo "${OUT}" | cut -d' ' -f 2 1>&2
    exit 1
fi
